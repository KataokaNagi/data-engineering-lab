
# 論文要約 『大規模 デジタルゲームにおける人工知能の一般的体系と実装』

- 陽一郎三宅, 「大規模 デジタルゲームにおける人工知能の一般的体系と実装」, 人工知能学会論文誌, vol. 35, no. 2, p. B-J64_1-16, 2020, doi: 10.1527/tjsai.B-J64.

<!-- -------------------- -->

## 背景
- 概要
    - 大規模なデジタルゲームにおける人工知能技術の理論、実装
- 用語
    - 環境
        - ゲームステージ全体
    - アセット
        - データ

### 静的から動的
- 静的
    - 移動領域の限定
    - 知能の限定
    - キャラがゲームシステムから操作
- 動的
    - 協調するシステム
        - NPCのAIが環境から独立した自律的知能
            - オブジェクトを認識して行動
        - システムからメタAIへ
        - 大規模環境を認識するナビゲーションAI
            - 肥大化した地形解析、パス検索
- スクリプトを書かないのでバグが少ない
- グラフ構造で意思決定

<!-- -------------------- -->

## 大型ゲームAIの構成
- スクリプテッドAI
    - ベタ書き

### 大規模ゲームAIの理論
- 自律型AI  
- 他律性
    - シナリオ通りに動く
- キャラクターAIの要点
    - 多様性
    - 拡張性
    - カスタマイズ性
- AI Graph
    - モードを指定して発動

### AI開発チーム構成
- 汎用AIを事前に設計
- スマートロケーション
    - 群衆の開発

<!-- -------------------- -->

## メタAI
- 古典的メタAI
    - セルフゲームコンロトールシステム
    - ユーザースキルに合うわせる
- 現代のメタAI（2000年代）
    - キャラ、配置、タイミング、地形、シナリオ、ユーザースキル
- 強いメタAI
    - ゲームデザインと連携
    - ユーザーを有利に
    - ゲームを大きく変化
- 弱いメタAI
    - 展開の微調整
    - 回復役を1人だけ向かわせる権限付与
- 開発後半の修正はキャラでなくメタAIで


<!-- -------------------- -->

## キャラAI
- 1キャラに数人～数十人
- キャラの要素
    - ボーン
    - リグ
    - アニメーション
    - コンセプトアート
    - モデリング
    - グラフィクス
    - 足音
    - 装備品
    - SE
    - 意思決定
    - セリフ
- 大きな未解決問題
    - アニメと意思決定の接続
    - 両者は継続的に動作
- 複数のボディレイヤー（ステートマシン）の導入
    - 汎用な抽象化
    - 仕様を追う必要がなくなる
- AnimGraph
- 意思決定は離散、NNやアニメは連続
- モーション遷移
    - 次のモーションに移るべきか
    - 同時にフェードさせるか

### エージェントアーキテクチャ
- エージェントアーキテクチャ
    - 2000-
    - センサーとエフェクターをもつ
    - 知能のモジュール
        - 身体
        - 記憶
        - センサー
        - 認識
        - 意思決定
        - 身体運動生成
    - 環境のモジュールと分離
- C4アーキテクチャ
    - MIT(2000)
    - 思考と記憶を分離

### センサー
- 基本
    - 視覚
        - レイキャスト
    - 聴覚
    - 衝突力検出
- 能力に差を出して多様性を表現
- 方向の差異化
    - 2種類の扇

### 意思決定
- アルゴリズムの組み合わせ
    - ベース＝選択
- 反射型
    - ルールベース
    - ステートベース
        - ステートマシン
            - 状況認識に優れる
    - ビヘイビアベース
        - 一連の小プランに優れる
        - 動作シーケンスが綺麗になるよう
        - 抽象から具体のノード
        - ビヘイビアツリーが多用される
            - 末端はビヘイビアノード
                - モーションを指定
            - 各層
                - 選択ルール
                - 競合するノード
                - シーケンスルール
                - プライオリティルール
                - ランダムルール
            - 優先度降順に記述
- 非反射型
    - ユーティリティベース
    - ゴールベース
    - タスクベース
    - シミュレーションベース
    - ケースベース

### AI Graph
- **ステートマシンとビヘイビアツリーの入れ子構造**
    - 状態と連続動作の双方に強い
    - 階層的に課題解決
- AI Graph Editor でGUI化

<!-- -------------------- -->

## AI Graphの問題点
- 表形式のデータをコンパクトにできない
    - キャラごとの設定表？

### AI Graph Editor
- ゲームデザイナーでも使えるように
- バイナリデータでシリアライズ
    - メモリ20MB
- 粒度に配慮して爆発を減らす
- ブラックボード
    - AIとゲームの情報の受け渡し領域
    - ローカルとグローバル
        - 層

### アセット化、オーバーライド
- AI Graphの再利用

### AIモード
- キャラごと
- ウェイトモード
- GoToモード
- リードモード
- フォローモード
- ノーマルモード
    - 通常稼働ＡＩ
- モード群の最上層にトレイ

### AI Graph Editor の利用実績

#### モンスター・キャラのAI Graph
- 3階層の知能レイヤー
    - AI Graph上の知能レイヤー
    - 表形式のデータ
    - ビヘイビアツリー
- 戦闘キャラ以外に戦闘禁止時間
- 主にアセット化

#### 兵士のAI Graph
- 3階層の知能レイヤー
    - ステートマシン
        - 肥大化、発散を防ぐ
    - ビヘイビアツリー
    - ステートマシン
        - 身体動作
- 主にアセット化
- ブラックボードで群化

#### 仲間のAI Graph
- ほぼステートマシン
- 15階層の多いAI Graph
- アセットは使いまわして分岐
- 末端は表データ
    - トリガー条件
    - 優先度フラグ
    - 挙動が多いため

### AI Graph の結果と考察
- AIモードをステートとするステートマシンを基本に
- AI Graphは学習コストが低い？

#### ビヘイビアツリーとステートマシンの効果
- 可読性の向上
- 容易な可視化

#### 表、AIモードの効果
- 末端を表データにすることでAI Graphの記載量を少なく

<!-- -------------------- -->

## ナビゲーションAI
- 地形の認識
    - 省メモリ
    - 省負荷
    - 客観的
    - 正確
    - 動的
- 世界表現
    - レベルデザインの地形全体・空間全体に対する表現
- A*アルゴリズムによるパス検索
    - 標準
- ウェイトポイント法
    - 90年代
    - ポイントの近接関係をネットワークグラフに落とす
- ナビゲーション・メッシュ法
    - 地形を凸多角形で覆う
    - 近接メッシュ同士がリンク

### 世界表現
- ナビゲーション・メッシュ法からA*アルゴリズム
- ナイトリービルド

### パス検索
- コストの最小化
    - ジグザグ
- ファンネル・アルゴリズム
    - スムージング
- 近距離のときはレイキャスト

<!-- -------------------- -->

## まとめ
- 大型ゲームは3 ～ 7年間
- スマートウェイポイント
    - 局所的な経路
- PQS（Point Query System）
    - 戦術的な位置
    - リアルタイム

## 所感
- ビジネス寄りは出し惜しみ
- AI != ML
- 技術の工夫より手段の工夫？
- りんなのような対話的システムの参考にはなるかも
- XAIでできることは少ない？
- ステートマシンとビヘイビアツリーの入れ子構造
    - おもしろい
    - 迷子にならん？
    - 例外に対処
    - 実際FFXVにはバグが多い
- 批判的思考も入れる
- 経路探索
    - 五十嵐研に近い
    - ロボットとの相性がよさそう
